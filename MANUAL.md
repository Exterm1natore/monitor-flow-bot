## Предисловие

Данное руководство предназначено для сотрудников, которые отслеживают состояние системы мониторинга для устранения проблем с отслеживаемыми объектами, а также для пользователя, именуемого в дальнейшем Администратором, управляющего подписчиками уведомлений, доступами пользователей и регистрациями во внутренней системе приложения.

## Описание

Система предназначена в основной своей сути для доставки уведомлений системы мониторинга в чат мессенджера VK Teams с целью сокращения времени, когда пользователь заметит уведомление. Уведомление должно приходить за минимальный промежуток времени после его создания системой мониторинга, не беря в расчёт скорость сети и передачи данных между сервисами.
Всё взаимодействие с приложением происходит через интерфейс VK Teams-бота, в том числе администрирование пользователей.

---

## Как получать уведомления от Zabbix?

1. Настройте media type в Zabbix, для отправки POST-запроса по webhook на URL приложения с его конечной точкой. (В теле запроса отправляемых данных указывается ключ `message` и строковое значение с описанием события).
2. Настройке action trigger в Zabbix и активируйте его, выбрав в параметре `only send to` созданный `media type`.
3. После чего настройте и запустите приложение по требованиям `README.md`.
4. После успешной настройке Zabbix и запуска приложения зайдите в интерфейс запущенного VKTeams-бота.
5. Зарегистрируйтесь и подпишитесь на уведомления типа `zabbix`.
6. Успех, теперь вы можете получать уведомления от системы мониторинга.

---
## Базовое взаимодействие

### Основные сведенья

Чтобы создать своего бота в VK Teams, необходимо обратиться к [@metabot](http://teams.vk.com/profile/70001).
Бот может взаимодействовать с приватными **чатами**, **группами**, а также **каналами**. Для того, чтобы добавить бота в чат или канал, необходимо через [@metabot](http://teams.vk.com/profile/70001) **разрешить боту добавляться в чаты**.
Внутри бота встроена команда `/help`, по этому рекомендуется при создании бота отключить возможность отвечать на стандартную команду `/help`.
Для более полного понимания создания и настройки бота, рекомендуются обратиться к официальной документации [VK Teams Bot API](https://teams.vk.com/botapi/tutorial/).

### Взаимодействие с чатами

Если вы администратор, то вам будет доступен функционал администратора и вы сможете узнать о нём введя команду `/help`.
Администраторами могут выступать только зарегистрированные пользователи приватных чатов с ботом.
Если вы взаимодействуете с ботом в группе или канале, то учитывайте, что команды регистрации, удаления, подписки и отписки на уведомления доступны только для администраторов групп или каналов. 
### Начало работы

1. Откройте чат с VK Teams-ботом.
2. Отправьте команду `/start`, чтобы получить приветственное сообщение.
3. Отправьте команду `/help`, чтобы получить информацию о доступных командах.
4. При необходимости выберете одну из доступных команд для исполнения заданного сценария.

### Список команд и описание

1. Отправьте команду `/help`.
2. Система отобразит доступные для вас команды и подскажет что они делают.

### Регистрация в системе

1. Отправьте команду `/register`.
2. Если вы не зарегистрированы, регистрация пройдёт успешно.


### Просмотр статуса своей регистрации

1. Отправьте команду `/status`.
2. Если вы зарегистрированы, система отобразит данные вашей регистрации.

### Удаление своей регистрации

1. Отправьте команду `/sign_out`.
2. Если вы зарегистрированы, то ваша регистрация будет удалена.

### Подписка на уведомления

Если вы администратор в системе или администратор группы, то сможете сразу подписаться на уведомления. В ином случае администраторам поступит запрос подписки на выбранный вами тип уведомления.

1. Отправьте команду `/notify_on`, чтобы узнать о формате команды и доступных опциях.
2. Отправьте `/notify_on` с опцией `<тип уведомления>`, чтобы оформить подписку или запросить доступ.

### Отписка от уведомлений

Если вы подписаны на один из доступных типов уведомлений, то сможете отписаться от него.

1. Отправьте команду `/notify_off` с опцией `<тип уведомления>`, чтобы отписаться от уведомлений на которые вы подписаны.
2. Если вы подписаны на введённый вами тип уведомлений, то вы успешно отпишетесь.


---

## Взаимодействие администраторов

### Описание 

Если вы являетесь администратором во внутренней системе регистраций, то сможете выполнять представленные здесь сценарии.

### Просмотр данных локального хранилища

1. Отправьте команду `/get_data` и ознакомьтесь с форматом и опциями.
2. Отправьте команду `/get_data` с опцией `<название таблицы>`, чтобы посмотреть записи таблицы локального хранилища.
3. Отображение представлено пагинацией.

### Поиск данных локального хранилища

1. Отправьте команду `/find_data` и ознакомьтесь с форматом и опциями.
2. Отправьте команду `/find_data` с опциями `<название таблицы>`, `<название поля таблицы>`, `<значение поля таблицы>`, чтобы отсортировать по выбранному полю и отобразить все найденные записи.
3. Отображение представлено пагинацией.

### Подписка любого чата на уведомления

1. Отправьте команду `/add_notify_subscriber` и ознакомьтесь с форматом и опциями.
2. Отправьте команду `/add_notify_subscriber` с опциями `<email чата>` и `<тип уведомлений>`.
3. Если чат не подписан на выбранный тип уведомлений и он существует, то вы успешного его подпишете.

### Отписка любого чата от уведомлений

1. Отправьте команду `/del_notify_subscriber` и ознакомьтесь с форматом и опциями.
2. Отправьте команду `/del_notify_subscriber` с опциями `<email чата>` и `<тип уведомлений>`.
3. Если чат подписан на выбранный тип уведомлений и он существует, то вы успешного его отпишете.

### Добавление нового администратора

1.  Отправьте команду `/add_admin` и ознакомьтесь с форматом и опциями.
2. Отправьте команду `/add_admin` с опцией `<email чата>`, чтобы сделать пользователя администратором.
3. Если пользователь ещё не администратор, то всё пройдёт корректно.

### Отзыв доступа администратора

Отозвать доступ можно у всех, кроме себя самого.

1. Отправьте команду `/del_admin` и ознакомьтесь с форматом и опциями.
2. Отправьте команду `/del_admin` с опцией `<email чата>`, чтобы отозвать доступ администратора у пользователя.
3. Если пользователь является администратором, то всё пройдёт корректно.

### Удалить чат

1. Отправьте команду `/del_chat` и ознакомьтесь с форматом и опциями.
2. Отправьте команду `/del_chat` с опцией `<email чата>`, чтобы удалить чат из локальной системы регистраций.
3. Если чат зарегистрирован, то он будет удалён.

---
## Поддержка

Для всех вопросов, связанных с взаимодействием с ботом или получением уведомлений, обращайтесь к разработчику:

**Разработчик**: Дорохов И.А.
**Почта**: iliadorox@gmail.com

---

_Данный мануал следует использовать как основное руководство по работе с системой. В случае обновлений или изменений — обязательно использовать актуальную версию документа._